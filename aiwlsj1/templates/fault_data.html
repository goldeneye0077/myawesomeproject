{% extends "base.html" %}

{% block title %}故障指标数据管理 - 网络视界指标后台管理{% endblock %}

{% block page_title %}故障指标数据管理{% endblock %}

{% block breadcrumb %}
    <li><span class="text-gray-300">/</span></li>
    <li><span class="text-gray-500">契约化指标分析</span></li>
    <li><span class="text-gray-300">/</span></li>
    <li><span class="text-gray-500">故障指标分析</span></li>
    <li><span class="text-gray-300">/</span></li>
    <li><span class="text-primary-600">故障指标数据管理</span></li>
{% endblock %}

{% block content %}
<!-- 故障数据列表卡片 -->
<div class="card modern-table-card" style="margin-top: 32px; position: relative; z-index: 0; border-radius: 16px; background: white; border: 1px solid #e9ecef; box-shadow: 0 4px 16px rgba(0,0,0,0.05);">
    <div class="card-header" style="background: rgba(255,255,255,0.9); backdrop-filter: blur(10px); padding: 24px; border-bottom: 1px solid rgba(0,0,0,0.1); display: flex; align-items: center; justify-content: space-between;">
        <div>
            <h3 style="margin: 0; font-size: 20px; color: #2c3e50; font-weight: 600;">
                <i class="fas fa-table" style="margin-right: 10px; color: #3498db;"></i>
                故障指标数据管理
            </h3>
            <p style="margin: 6px 0 0 0; font-size: 14px; color: #7f8c8d;">故障数据详细管理 - 支持筛选、批量操作和数据导入导出</p>
        </div>
        <div style="display: flex; gap: 8px; align-items: center;">
            <a href="/fault/add_fault_data" class="btn-primary" style="padding: 8px 16px; background: #3498db; color: white; border: none; border-radius: 6px; font-size: 14px; cursor: pointer; display: flex; align-items: center; gap: 4px; text-decoration: none; transition: all 0.3s;">
                <svg style="width: 16px; height: 16px;" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 4v16m8-8H4"/>
                </svg>
                添加故障数据
            </a>
        </div>
    </div>
    <div class="card-body" style="padding: 24px;">
        <!-- 筛选表单 -->
        <form method="get" id="filterForm" style="background: #f8f9fa; padding: 16px; border-radius: 8px; margin-bottom: 24px; display: flex; gap: 16px; align-items: center; flex-wrap: wrap;">
            <label style="color: #2c3e50; font-weight: 500; display: flex; align-items: center; gap: 8px;">故障类型：
                <select name="fault_type" onchange="document.getElementById('filterForm').submit();" style="padding: 6px 12px; border: 1px solid #dee2e6; border-radius: 6px; background: white; color: #2c3e50; min-width: 120px;">
                    <option value="">全部</option>
                    {% for type in all_fault_types %}
                    <option value="{{ type }}" {% if current_fault_type==type %}selected{% endif %}>{{ type }}</option>
                    {% endfor %}
                </select>
            </label>
            <label style="color: #2c3e50; font-weight: 500; display: flex; align-items: center; gap: 8px;">原因分类：
                <select name="cause_category" onchange="document.getElementById('filterForm').submit();" style="padding: 6px 12px; border: 1px solid #dee2e6; border-radius: 6px; background: white; color: #2c3e50; min-width: 120px;">
                    <option value="">全部</option>
                    {% for category in all_cause_categories %}
                    <option value="{{ category }}" {% if current_cause_category==category %}selected{% endif %}>{{ category }}</option>
                    {% endfor %}
                </select>
            </label>
            <label style="color: #2c3e50; font-weight: 500; display: flex; align-items: center; gap: 8px;">通报级别：
                <select name="notification_level" onchange="document.getElementById('filterForm').submit();" style="padding: 6px 12px; border: 1px solid #dee2e6; border-radius: 6px; background: white; color: #2c3e50; min-width: 120px;">
                    <option value="">全部</option>
                    {% for level in all_notification_levels %}
                    <option value="{{ level }}" {% if current_notification_level==level %}selected{% endif %}>{{ level }}</option>
                    {% endfor %}
                </select>
            </label>
            <input type="hidden" name="page" value="1">
        </form>

        <!-- 操作按钮区 -->
        <div class="action-bar" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding: 16px; background: #fafafa; border-radius: 8px; flex-wrap: wrap; gap: 16px;">
            <div class="action-left" style="display: flex; align-items: center; gap: 8px;">
                <a href="/fault/import_fault_data" class="btn btn-secondary" style="padding: 8px 16px; background: #95a5a6; color: white; border: none; border-radius: 6px; font-size: 14px; cursor: pointer; display: flex; align-items: center; gap: 4px; text-decoration: none; transition: all 0.3s;">
                    <svg style="width: 16px; height: 16px;" fill="currentColor" viewBox="0 0 24 24"><path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/></svg>
                    批量导入
                </a>
                <a href="/fault/export_fault_data" class="btn btn-success" style="padding: 8px 16px; background: #27ae60; color: white; border: none; border-radius: 6px; font-size: 14px; cursor: pointer; display: flex; align-items: center; gap: 4px; text-decoration: none; transition: all 0.3s;">
                    <svg style="width: 16px; height: 16px;" fill="currentColor" viewBox="0 0 24 24"><path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/></svg>
                    导出数据
                </a>
            </div>
            <div class="action-right" style="display: flex; align-items: center; gap: 12px;">
                <span id="selectedCount" class="selected-count" style="color: #7f8c8d; font-size: 14px;">0 项已选中</span>
                <button type="button" id="batchDeleteBtn" class="btn btn-danger" disabled style="padding: 8px 16px; background: #e74c3c; color: white; border: none; border-radius: 6px; font-size: 14px; cursor: pointer; transition: all 0.3s; opacity: 0.6;">
                    <svg style="width: 16px; height: 16px; margin-right: 4px;" fill="currentColor" viewBox="0 0 24 24"><path d="M19,4H15.5L14.5,3H9.5L8.5,4H5V6H19M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19Z"/></svg>
                    批量删除
                </button>
            </div>
        </div>

        <div class="data-table-container" style="overflow-x: auto; max-height: 600px; border-radius: 8px; border: 1px solid #e0e0e0;">
            <table class="modern-data-table compact-view" style="width: 100%; border-collapse: collapse; background: white;">
                <thead style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); position: sticky; top: 0; z-index: 10;">
                    <tr>
                        <th style="background: #2c3e50; color: white; padding: 16px 20px; text-align: center; font-weight: 600; border-right: 2px solid white; position: sticky; left: 0; z-index: 11; min-width: 50px; white-space: nowrap;">
                            <input type="checkbox" id="selectAll" onchange="toggleSelectAll()" style="transform: scale(1.2);">
                        </th>
                        <th style="background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); color: white; padding: 12px 20px; text-align: center; font-weight: 600; border-right: 2px solid white; white-space: nowrap; min-width: 130px;" title="故障发生的日期和时间">故障日期</th>
                        <th style="background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%); color: white; padding: 12px 18px; text-align: center; font-weight: 500; border-right: 1px solid rgba(255,255,255,0.2); font-size: 13px; min-width: 150px; white-space: nowrap;" title="故障的具体名称和描述">故障名称</th>
                        <th style="background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%); color: white; padding: 12px 18px; text-align: center; font-weight: 500; border-right: 1px solid rgba(255,255,255,0.2); font-size: 13px; min-width: 120px; white-space: nowrap;" title="省级对故障类型的分类">省-故障类型</th>
                        <th style="background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%); color: white; padding: 12px 18px; text-align: center; font-weight: 500; border-right: 1px solid rgba(255,255,255,0.2); font-size: 13px; min-width: 100px; white-space: nowrap;" title="故障原因的分类类型">原因分类</th>
                        <th style="background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%); color: white; padding: 12px 18px; text-align: center; font-weight: 500; border-right: 1px solid rgba(255,255,255,0.2); font-size: 13px; min-width: 100px; white-space: nowrap;" title="故障通报的级别和重要性">通报级别</th>
                        <th style="background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%); color: white; padding: 12px 18px; text-align: center; font-weight: 500; border-right: 1px solid rgba(255,255,255,0.2); font-size: 13px; min-width: 110px; white-space: nowrap;" title="故障处理所耗费的时间（小时）">处理时长(小时)</th>
                        <th style="background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%); color: white; padding: 12px 18px; text-align: center; font-weight: 500; border-right: 1px solid rgba(255,255,255,0.2); font-size: 13px; min-width: 90px; white-space: nowrap;" title="是否为主动发现的故障">主动发现</th>
                        <th style="background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%); color: white; padding: 12px 18px; text-align: center; font-weight: 500; border-right: 1px solid rgba(255,255,255,0.2); font-size: 13px; min-width: 130px; white-space: nowrap;" title="故障开始发生的具体时间">发生时间</th>
                        <th style="background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%); color: white; padding: 12px 18px; text-align: center; font-weight: 500; border-right: 1px solid rgba(255,255,255,0.2); font-size: 13px; min-width: 130px; white-space: nowrap;" title="故障处理完成的具体时间">结束时间</th>
                        <th style="background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%); color: white; padding: 12px 18px; text-align: center; font-weight: 500; border-right: 1px solid rgba(255,255,255,0.2); font-size: 13px; min-width: 120px; white-space: nowrap;" title="用户投诉的具体情况和处理结果">投诉情况</th>
                        <th style="background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%); color: white; padding: 12px 18px; text-align: center; font-weight: 500; border-right: 1px solid rgba(255,255,255,0.2); font-size: 13px; min-width: 150px; white-space: nowrap;" title="引起故障的具体原因分析">故障原因</th>
                        <th style="background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%); color: white; padding: 12px 18px; text-align: center; font-weight: 500; border-right: 1px solid rgba(255,255,255,0.2); font-size: 13px; min-width: 150px; white-space: nowrap;" title="故障的处理过程和解决方案">故障处理</th>
                        <th style="background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%); color: white; padding: 12px 18px; text-align: center; font-weight: 500; border-right: 1px solid rgba(255,255,255,0.2); font-size: 13px; min-width: 120px; white-space: nowrap;" title="省级对故障原因的分类">省-原因分类</th>
                        <th style="background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%); color: white; padding: 12px 18px; text-align: center; font-weight: 500; border-right: 1px solid rgba(255,255,255,0.2); font-size: 13px; min-width: 150px; white-space: nowrap;" title="省级对故障原因的详细分析">省-故障原因分析</th>
                        <th style="background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%); color: white; padding: 12px 18px; text-align: center; font-weight: 500; border-right: 1px solid rgba(255,255,255,0.2); font-size: 13px; min-width: 100px; white-space: nowrap;" title="其他补充说明和备注信息">备注</th>
                        <th style="background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%); color: white; padding: 12px 18px; text-align: center; font-weight: 500; border-right: 1px solid rgba(255,255,255,0.2); font-size: 13px; min-width: 100px; white-space: nowrap;" title="记录创建的日期和时间">创建时间</th>
                        <th style="background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%); color: white; padding: 12px 18px; text-align: center; font-weight: 500; border-right: 1px solid rgba(255,255,255,0.2); font-size: 13px; min-width: 100px; white-space: nowrap;" title="记录最后修改的日期和时间">更新时间</th>
                        <th style="background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%); color: white; padding: 12px 18px; text-align: center; font-weight: 500; border-right: 1px solid rgba(255,255,255,0.2); font-size: 13px; min-width: 130px; white-space: nowrap;" title="编辑、删除、查看等操作按钮">操作</th>
                </tr>
            </thead>
            <tbody>
                {% for item in fault_data_list %}
                <tr class="data-row" style="transition: all 0.3s ease;" onmouseover="this.style.background='rgba(52, 152, 219, 0.05)'" onmouseout="this.style.background='white'">
                    <td class="checkbox-column" style="background: #f8f9fa; padding: 12px 16px; text-align: center; border-right: 2px solid #dee2e6; position: sticky; left: 0; z-index: 9;">
                        <input type="checkbox" class="row-checkbox" value="{{ item.id }}" onchange="updateSelectedCount()" style="transform: scale(1.2);">
                    </td>
                    <td title="{{ item.fault_date.strftime('%Y-%m-%d %H:%M:%S') if item.fault_date else '无日期' }}" style="padding: 12px 16px; text-align: center; font-weight: 500; border-right: 1px solid #dee2e6; border-bottom: 1px solid #f0f0f0; min-width: 130px; white-space: nowrap; color: #2c3e50;">
                        {{ item.fault_date.strftime('%Y-%m-%d %H:%M') if item.fault_date else '-' }}
                    </td>
                    <td title="{{ item.fault_name or '' }}" style="padding: 12px 16px; text-align: left; border-right: 1px solid #dee2e6; border-bottom: 1px solid #f0f0f0; max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; color: #2c3e50; font-weight: 500;">
                        {{ (item.fault_name[:30] + '...') if item.fault_name and item.fault_name|length > 30 else (item.fault_name or '-') }}
                    </td>
                    <td style="padding: 12px 16px; text-align: center; border-right: 1px solid #dee2e6; border-bottom: 1px solid #f0f0f0; color: #34495e;">{{ item.province_fault_type or '-' }}</td>
                    <td style="padding: 12px 16px; text-align: center; border-right: 1px solid #dee2e6; border-bottom: 1px solid #f0f0f0; color: #34495e;">{{ item.cause_category or '-' }}</td>
                    <td style="padding: 12px 16px; text-align: center; border-right: 1px solid #dee2e6; border-bottom: 1px solid #f0f0f0; min-width: 100px;">
                        <span class="modern-badge {% if item.notification_level and ('重大' in item.notification_level or '严重' in item.notification_level) %}badge-danger{% elif item.notification_level and '一般' in item.notification_level %}badge-warning{% else %}badge-info{% endif %}">
                            {{ item.notification_level or '-' }}
                        </span>
                    </td>
                    <td style="padding: 12px 16px; text-align: center; border-right: 1px solid #dee2e6; border-bottom: 1px solid #f0f0f0; color: #34495e; font-weight: 500;">{{ "{:.2f}".format(item.fault_duration_hours) if item.fault_duration_hours else '-' }}</td>
                    <td style="padding: 12px 16px; text-align: center; border-right: 1px solid #dee2e6; border-bottom: 1px solid #f0f0f0;">
                        <span class="modern-badge {% if item.is_proactive_discovery == '是' %}badge-success{% elif item.is_proactive_discovery == '否' %}badge-secondary{% else %}badge-light{% endif %}">
                            {{ item.is_proactive_discovery or '-' }}
                        </span>
                    </td>
                    <td title="{{ item.start_time.strftime('%Y-%m-%d %H:%M:%S') if item.start_time else '无发生时间' }}" style="padding: 12px 16px; text-align: center; border-right: 1px solid #dee2e6; border-bottom: 1px solid #f0f0f0; min-width: 130px; white-space: nowrap; color: #7f8c8d; font-size: 13px;">
                        {{ item.start_time.strftime('%Y-%m-%d %H:%M') if item.start_time else '-' }}
                    </td>
                    <td title="{{ item.end_time.strftime('%Y-%m-%d %H:%M:%S') if item.end_time else '无结束时间' }}" style="padding: 12px 16px; text-align: center; border-right: 1px solid #dee2e6; border-bottom: 1px solid #f0f0f0; min-width: 130px; white-space: nowrap; color: #7f8c8d; font-size: 13px;">
                        {{ item.end_time.strftime('%Y-%m-%d %H:%M') if item.end_time else '-' }}
                    </td>
                    <td title="{{ item.complaint_situation or '' }}" style="padding: 12px 16px; text-align: left; border-right: 1px solid #dee2e6; border-bottom: 1px solid #f0f0f0; max-width: 100px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; color: #34495e;">
                        {{ (item.complaint_situation[:20] + '...') if item.complaint_situation and item.complaint_situation|length > 20 else (item.complaint_situation or '-') }}
                    </td>
                    <td title="{{ item.fault_cause or '' }}" style="padding: 12px 16px; text-align: left; border-right: 1px solid #dee2e6; border-bottom: 1px solid #f0f0f0; max-width: 150px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; color: #34495e;">
                        {{ (item.fault_cause[:30] + '...') if item.fault_cause and item.fault_cause|length > 30 else (item.fault_cause or '-') }}
                    </td>
                    <td title="{{ item.fault_handling or '' }}" style="padding: 12px 16px; text-align: left; border-right: 1px solid #dee2e6; border-bottom: 1px solid #f0f0f0; max-width: 150px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; color: #34495e;">
                        {{ (item.fault_handling[:30] + '...') if item.fault_handling and item.fault_handling|length > 30 else (item.fault_handling or '-') }}
                    </td>
                    <td style="padding: 12px 16px; text-align: center; border-right: 1px solid #dee2e6; border-bottom: 1px solid #f0f0f0; color: #34495e;">{{ item.province_cause_category or '-' }}</td>
                    <td title="{{ item.province_cause_analysis or '' }}" style="padding: 12px 16px; text-align: left; border-right: 1px solid #dee2e6; border-bottom: 1px solid #f0f0f0; max-width: 150px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; color: #34495e;">
                        {{ (item.province_cause_analysis[:30] + '...') if item.province_cause_analysis and item.province_cause_analysis|length > 30 else (item.province_cause_analysis or '-') }}
                    </td>
                    <td title="{{ item.remarks or '' }}" style="padding: 12px 16px; text-align: left; border-right: 1px solid #dee2e6; border-bottom: 1px solid #f0f0f0; max-width: 100px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; color: #7f8c8d;">
                        {{ (item.remarks[:20] + '...') if item.remarks and item.remarks|length > 20 else (item.remarks or '-') }}
                    </td>
                    <td title="{{ item.created_at.strftime('%Y-%m-%d %H:%M:%S') if item.created_at else '无创建时间' }}" style="padding: 12px 16px; text-align: center; border-right: 1px solid #dee2e6; border-bottom: 1px solid #f0f0f0; min-width: 100px; white-space: nowrap; color: #7f8c8d; font-size: 13px;">
                        {{ item.created_at.strftime('%Y-%m-%d') if item.created_at else '-' }}
                    </td>
                    <td title="{{ item.updated_at.strftime('%Y-%m-%d %H:%M:%S') if item.updated_at else '无更新时间' }}" style="padding: 12px 16px; text-align: center; border-right: 1px solid #dee2e6; border-bottom: 1px solid #f0f0f0; min-width: 100px; white-space: nowrap; color: #7f8c8d; font-size: 13px;">
                        {{ item.updated_at.strftime('%Y-%m-%d') if item.updated_at else '-' }}
                    </td>
                    <td class="action-column" style="padding: 12px 16px; text-align: center; border-bottom: 1px solid #f0f0f0; min-width: 130px; white-space: nowrap;">
                        <div class="action-buttons" style="display: flex; gap: 4px; justify-content: center; flex-wrap: wrap;">
                            <a href="/fault/edit_fault_data/{{ item.id }}" class="btn-xs modern-btn-primary" title="编辑" style="padding: 4px 8px; background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); color: white; border: none; border-radius: 4px; font-size: 11px; text-decoration: none; transition: all 0.3s; display: flex; align-items: center; font-weight: 500;">编辑</a>
                            <a href="/fault/delete_fault_data/{{ item.id }}" class="btn-xs modern-btn-danger" onclick="return confirm('确定要删除吗？');" title="删除" style="padding: 4px 8px; background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); color: white; border: none; border-radius: 4px; font-size: 11px; text-decoration: none; transition: all 0.3s; display: flex; align-items: center; font-weight: 500;">删除</a>
                            <a href="/fault/view_fault_data/{{ item.id }}" class="btn-xs modern-btn-info" title="详情" style="padding: 4px 8px; background: linear-gradient(135deg, #17a2b8 0%, #138496 100%); color: white; border: none; border-radius: 4px; font-size: 11px; text-decoration: none; transition: all 0.3s; display: flex; align-items: center; font-weight: 500;">详情</a>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
        <!-- 现代化分页控件 -->
        <div style="margin-top: 24px; display: flex; justify-content: space-between; align-items: center; padding: 16px 24px; background: #f8f9fa; border-radius: 12px; border: 1px solid #e9ecef;">
            <div style="display: flex; gap: 8px; align-items: center;">
                {% if page > 1 %}
                    <a href="?page=1{% if current_fault_type %}&fault_type={{ current_fault_type }}{% endif %}{% if current_cause_category %}&cause_category={{ current_cause_category }}{% endif %}{% if current_notification_level %}&notification_level={{ current_notification_level }}{% endif %}" class="page-link modern-page-btn" style="padding: 6px 12px; background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); color: white; border-radius: 4px; text-decoration: none; font-size: 12px; transition: all 0.3s; font-weight: 500;">首页</a>
                    <a href="?page={{ page - 1 }}{% if current_fault_type %}&fault_type={{ current_fault_type }}{% endif %}{% if current_cause_category %}&cause_category={{ current_cause_category }}{% endif %}{% if current_notification_level %}&notification_level={{ current_notification_level }}{% endif %}" class="page-link modern-page-btn" style="padding: 6px 12px; background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); color: white; border-radius: 4px; text-decoration: none; font-size: 12px; transition: all 0.3s; font-weight: 500;">上一页</a>
                {% endif %}
                {% if page < pages %}
                    <a href="?page={{ page + 1 }}{% if current_fault_type %}&fault_type={{ current_fault_type }}{% endif %}{% if current_cause_category %}&cause_category={{ current_cause_category }}{% endif %}{% if current_notification_level %}&notification_level={{ current_notification_level }}{% endif %}" class="page-link modern-page-btn" style="padding: 6px 12px; background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); color: white; border-radius: 4px; text-decoration: none; font-size: 12px; transition: all 0.3s; font-weight: 500;">下一页</a>
                    <a href="?page={{ pages }}{% if current_fault_type %}&fault_type={{ current_fault_type }}{% endif %}{% if current_cause_category %}&cause_category={{ current_cause_category }}{% endif %}{% if current_notification_level %}&notification_level={{ current_notification_level }}{% endif %}" class="page-link modern-page-btn" style="padding: 6px 12px; background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); color: white; border-radius: 4px; text-decoration: none; font-size: 12px; transition: all 0.3s; font-weight: 500;">末页</a>
                {% endif %}
            </div>
            <div style="display: flex; align-items: center; gap: 16px;">
                <span style="color: #7f8c8d; font-size: 14px; font-weight: 500;">第 {{ page }} / {{ pages }} 页</span>
                <span style="color: #7f8c8d; font-size: 14px; font-weight: 500;">共 {{ total }} 条记录</span>
            </div>
        </div>
    </div>
</div>

<style>
/* 现代化徽章样式 */
.modern-badge {
    padding: 4px 12px;
    border-radius: 16px;
    font-size: 11px;
    font-weight: 600;
    white-space: nowrap;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}

.modern-badge:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.modern-badge.badge-danger { 
    background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); 
    color: white; 
}
.modern-badge.badge-warning { 
    background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%); 
    color: white; 
}
.modern-badge.badge-success { 
    background: linear-gradient(135deg, #27ae60 0%, #229954 100%); 
    color: white; 
}
.modern-badge.badge-info { 
    background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); 
    color: white; 
}
.modern-badge.badge-secondary { 
    background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%); 
    color: white; 
}
.modern-badge.badge-light { 
    background: linear-gradient(135deg, #ecf0f1 0%, #d5dbdb 100%); 
    color: #2c3e50; 
    border: 1px solid #bdc3c7; 
}

/* 保持原有徽章样式以防兼容性问题 */
.badge {
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 0.8em;
    font-weight: 500;
    white-space: nowrap;
}
.badge-danger { background-color: #dc3545; color: white; }
.badge-warning { background-color: #ffc107; color: #212529; }
.badge-success { background-color: #28a745; color: white; }
.badge-info { background-color: #17a2b8; color: white; }
.badge-secondary { background-color: #6c757d; color: white; }
.badge-light { background-color: #f8f9fa; color: #212529; border: 1px solid #dee2e6; }

/* 批量操作样式 */
.action-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
    flex-wrap: wrap;
    gap: 1rem;
}

.action-left, .action-right {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.selected-count {
    font-size: 0.9em;
    color: #6c757d;
    margin-right: 0.5rem;
}

.checkbox-column {
    width: 40px;
    text-align: center;
    padding: 6px 4px !important;
}

.checkbox-column input[type="checkbox"] {
    margin: 0;
    cursor: pointer;
}

.row-checkbox:checked {
    accent-color: #007bff;
}

#selectAll {
    cursor: pointer;
}

.data-table th, .data-table td {
    padding: 6px 4px;
    font-size: 0.8em;
    line-height: 1.3;
    vertical-align: middle;
}

.data-table {
    font-size: 0.8em;
}

.data-table th {
    font-size: 0.75em;
    font-weight: 600;
    background-color: #f8f9fa;
    border-bottom: 2px solid #dee2e6;
    white-space: nowrap;
}

.data-table tbody tr:hover {
    background-color: #f5f5f5;
}

.data-table-container {
    overflow-x: auto;
    max-width: 100%;
}

/* 操作列样式 */
.action-column {
    min-width: 120px;
    width: 120px;
    text-align: center;
    padding: 4px 2px !important;
}

.action-buttons {
    display: flex;
    flex-direction: column;
    gap: 2px;
    align-items: center;
}

/* 现代化按钮样式 */
.btn-xs {
    display: inline-block;
    padding: 4px 8px;
    font-size: 11px;
    line-height: 1.2;
    border-radius: 4px;
    text-decoration: none;
    color: white;
    font-weight: 600;
    min-width: 45px;
    text-align: center;
    transition: all 0.3s ease;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    letter-spacing: 0.3px;
}

.btn-xs:hover {
    text-decoration: none;
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(0,0,0,0.2);
}

.modern-btn-primary:hover {
    background: linear-gradient(135deg, #2980b9 0%, #21618c 100%) !important;
}

.modern-btn-danger:hover {
    background: linear-gradient(135deg, #c0392b 0%, #a93226 100%) !important;
}

.modern-btn-info:hover {
    background: linear-gradient(135deg, #138496 0%, #0f6674 100%) !important;
}

.btn-primary {
    background-color: #007bff;
    border: 1px solid #007bff;
}

.btn-primary:hover {
    background-color: #0056b3;
    border-color: #0056b3;
}

.btn-danger {
    background-color: #dc3545;
    border: 1px solid #dc3545;
}

.btn-danger:hover {
    background-color: #c82333;
    border-color: #bd2130;
}

.btn-info {
    background-color: #17a2b8;
    border: 1px solid #17a2b8;
}

.btn-info:hover {
    background-color: #138496;
    border-color: #117a8b;
}

/* 现代化分页样式 */
.pagination {
    margin-top: 24px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
    background: #f8f9fa;
    padding: 16px 24px;
    border-radius: 12px;
    border: 1px solid #e9ecef;
}

.modern-page-btn {
    display: inline-block;
    padding: 6px 12px;
    margin: 0 2px;
    text-decoration: none;
    color: white;
    background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
    border: none;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 500;
    transition: all 0.3s ease;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}

.modern-page-btn:hover {
    background: linear-gradient(135deg, #2980b9 0%, #21618c 100%) !important;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    text-decoration: none;
    color: white;
}

.page-link {
    display: inline-block;
    padding: 8px 12px;
    margin: 0 2px;
    text-decoration: none;
    color: #007bff;
    background-color: #fff;
    border: 1px solid #dee2e6;
    border-radius: 4px;
    font-size: 0.9em;
    transition: all 0.2s ease;
}

.page-link:hover {
    color: #0056b3;
    background-color: #e9ecef;
    border-color: #adb5bd;
    text-decoration: none;
}

.page-link:active {
    color: #fff;
    background-color: #007bff;
    border-color: #007bff;
}

.pagination span {
    padding: 8px 12px;
    margin: 0 4px;
    font-size: 0.9em;
    color: #6c757d;
}

/* 现代化表格交互效果 */
.modern-data-table.compact-view th,
.modern-data-table.compact-view td {
    padding: 8px 16px !important;
    font-size: 12px !important;
}

.data-row:hover .modern-badge {
    transform: scale(1.05);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.data-row:hover .btn-xs {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

/* 表格行交替背景色 */
.modern-data-table tbody tr:nth-child(even) {
    background-color: rgba(248, 249, 250, 0.5);
}

.modern-data-table tbody tr:nth-child(odd) {
    background-color: white;
}

/* 悬停时的微妙阴影效果 */
.modern-data-table tbody tr:hover {
    box-shadow: 0 4px 16px rgba(52, 152, 219, 0.1);
    position: relative;
    z-index: 2;
}

/* 复选框样式增强 */
.checkbox-column input[type="checkbox"] {
    transform: scale(1.2);
    accent-color: #3498db;
    cursor: pointer;
}

/* 响应式设计 */
@media (max-width: 768px) {
    .action-buttons {
        flex-direction: column;
        gap: 2px;
    }
    
    .btn-xs {
        padding: 3px 6px;
        font-size: 10px;
        min-width: 38px;
    }
    
    .action-column {
        min-width: 100px;
        width: 100px;
    }
    
    .modern-badge {
        font-size: 10px;
        padding: 2px 8px;
    }
    
    .pagination {
        flex-direction: column;
        gap: 12px;
        text-align: center;
    }
}
</style>

<script>
// 全选/取消全选功能
function toggleSelectAll() {
    const selectAllCheckbox = document.getElementById('selectAll');
    const rowCheckboxes = document.querySelectorAll('.row-checkbox');
    
    rowCheckboxes.forEach(checkbox => {
        checkbox.checked = selectAllCheckbox.checked;
    });
    
    updateSelectedCount();
}

// 更新选中数量
function updateSelectedCount() {
    const rowCheckboxes = document.querySelectorAll('.row-checkbox');
    const checkedBoxes = document.querySelectorAll('.row-checkbox:checked');
    const selectAllCheckbox = document.getElementById('selectAll');
    const selectedCountSpan = document.getElementById('selectedCount');
    const batchDeleteBtn = document.getElementById('batchDeleteBtn');
    
    const selectedCount = checkedBoxes.length;
    const totalCount = rowCheckboxes.length;
    
    // 更新选中数量显示
    selectedCountSpan.textContent = `${selectedCount} 项已选中`;
    
    // 更新批量删除按钮状态
    batchDeleteBtn.disabled = selectedCount === 0;
    
    // 更新全选复选框状态
    if (selectedCount === 0) {
        selectAllCheckbox.indeterminate = false;
        selectAllCheckbox.checked = false;
    } else if (selectedCount === totalCount) {
        selectAllCheckbox.indeterminate = false;
        selectAllCheckbox.checked = true;
    } else {
        selectAllCheckbox.indeterminate = true;
        selectAllCheckbox.checked = false;
    }
}

// 批量删除功能
function batchDelete() {
    console.log('批量删除函数被调用');
    const checkedBoxes = document.querySelectorAll('.row-checkbox:checked');
    console.log('选中的复选框数量:', checkedBoxes.length);
    
    if (checkedBoxes.length === 0) {
        alert('请先选择要删除的记录');
        return;
    }
    
    const selectedIds = Array.from(checkedBoxes).map(checkbox => checkbox.value);
    const confirmMessage = `确定要删除选中的 ${selectedIds.length} 条记录吗？此操作不可撤销。`;
    
    if (confirm(confirmMessage)) {
        // 创建表单并提交
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '/fault/batch_delete';
        form.style.display = 'none';
        
        selectedIds.forEach(id => {
            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = 'ids';
            input.value = id;
            form.appendChild(input);
        });
        
        document.body.appendChild(form);
        form.submit();
    }
}

// 页面加载完成后初始化
document.addEventListener('DOMContentLoaded', function() {
    console.log('页面加载完成');
    updateSelectedCount();
    
    // 绑定批量删除按钮事件
    const batchDeleteBtn = document.getElementById('batchDeleteBtn');
    console.log('批量删除按钮:', batchDeleteBtn);
    if (batchDeleteBtn) {
        batchDeleteBtn.addEventListener('click', batchDelete);
        console.log('批量删除按钮事件已绑定');
    }
});
</script>
{% endblock %}

{% block scripts %}
<script>
    function confirmDelete(id) {
        if (confirm('确定要删除这条故障数据记录吗？此操作不可恢复。')) {
            window.location.href = '/delete_fault_data/' + id;
        }
    }
</script>
{% endblock %}
