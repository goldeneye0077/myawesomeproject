{% extends "base.html" %}

{% block title %}PUE数据管理 - 网络视界指标后台管理{% endblock %}

{% block page_title %}PUE数据管理{% endblock %}

{% block breadcrumb %}
    <li><span class="text-gray-300">/</span></li>
    <li><span class="text-gray-500">契约化指标分析</span></li>
    <li><span class="text-gray-300">/</span></li>
    <li><span class="text-gray-500">PUE指标</span></li>
    <li><span class="text-gray-300">/</span></li>
    <li><span class="text-primary-600">PUE指标数据管理</span></li>
{% endblock %}

{% block page_actions %}
    <a href="/add_pue" class="btn-primary">
        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
        </svg>
        添加PUE数据
    </a>
{% endblock %}

{% block content %}
<!-- PUE数据列表卡片 -->
<div class="card">
    <h2 class="card-title">PUE数据管理</h2>

    <!-- 筛选表单 -->
    <form method="get" id="filterForm" style="margin-bottom: 18px; display: flex; gap: 18px; align-items: center; flex-wrap: wrap;">
        <label>地点：
            <select name="location" onchange="document.getElementById('filterForm').submit();" style="min-width: 60px;">
                <option value="">全部</option>
                {% for loc in all_locations %}
                <option value="{{ loc }}" {% if current_location==loc %}selected{% endif %}>{{ loc }}</option>
                {% endfor %}
            </select>
        </label>
        <label>年份：
            <select name="year" onchange="document.getElementById('filterForm').submit();" style="min-width: 60px;">
                <option value="">全部</option>
                {% for y in all_years %}
                <option value="{{ y }}" {% if current_year==y %}selected{% endif %}>{{ y }}</option>
                {% endfor %}
            </select>
        </label>
        <input type="hidden" name="page" value="1">
    </form>

    <!-- 操作按钮区 -->
    <div class="action-bar">
        <a href="/add_pue_data" class="btn btn-primary">添加PUE数据</a>

    </div>

    <div class="data-table-container">
        <table class="data-table">
            <thead class="sticky-header">
                <tr>
                    <th>地点</th>
                    <th>年份</th>
                    <th>月份</th>
                    <th>PUE值</th>
                    <th>创建时间</th>
                    <th>更新时间</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody>
                {% for item in pue_data_list %}
                <tr>
                    <td>{{ item.location }}</td>
                    <td>{{ item.year }}</td>
                    <td>{{ item.month }}</td>
                    <td>{{ "{:.2f}".format(item.pue_value) }}</td>
                    <td>{{ item.created_at.strftime('%Y-%m-%d') if item.created_at else '' }}</td>
                    <td>{{ item.updated_at.strftime('%Y-%m-%d') if item.updated_at else '' }}</td>
                    <td>
                        <a href="/edit_pue_data/{{ item.id }}" class="btn btn-sm btn-primary">编辑</a>
                        <a href="/delete_pue_data/{{ item.id }}" class="btn btn-sm btn-danger" onclick="return confirm('确定要删除吗？');">删除</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <!-- 分页控件 -->
    <div class="pagination" style="margin-top: 18px; display: flex; justify-content: center; align-items: center; gap: 8px;">
        {% if page > 1 %}
            <a href="?page=1&location={{ current_location }}&year={{ current_year }}" class="page-link">首页</a>
            <a href="?page={{ page - 1 }}&location={{ current_location }}&year={{ current_year }}" class="page-link">上一页</a>
        {% endif %}
        <span>第 {{ page }} / {{ pages }} 页</span>
        {% if page < pages %}
            <a href="?page={{ page + 1 }}&location={{ current_location }}&year={{ current_year }}" class="page-link">下一页</a>
            <a href="?page={{ pages }}&location={{ current_location }}&year={{ current_year }}" class="page-link">末页</a>
        {% endif %}
        <span style="margin-left:12px;">共 {{ total }} 条</span>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    function confirmDelete(id) {
        if (confirm('确定要删除这条PUE数据记录吗？此操作不可恢复。')) {
            window.location.href = '/delete_pue_data/' + id;
        }
    }

    document.addEventListener('DOMContentLoaded', function() {
        const fileInput = document.getElementById('file');
        const fileNameDisplay = document.getElementById('file-name-display');

        if(fileInput && fileNameDisplay) {
            fileInput.addEventListener('change', function() {
                if (this.files.length > 0) {
                    fileNameDisplay.textContent = this.files[0].name;
                } else {
                    fileNameDisplay.textContent = '';
                }
            });
        }
    });
</script>
{% endblock %}